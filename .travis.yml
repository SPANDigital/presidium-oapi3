jobs:
  include:
  - stage: Tag code
    if: branch IN (develop, master) AND type = push AND NOT (commit_message =~ /^.*\[NPM version\].*$/)
    language: go
    go:
    - 1.17.x
    services:
    - docker
    git:
      depth: false
    script:
    - "./build/ci/tag_code.sh"
  - stage: Release
    if: tag IS present
    language: go
    go:
    - 1.17.x
    script:
    - curl -sfL https://git.io/goreleaser | sh -s -- check
    deploy:
    - provider: script
      skip_cleanup: true
      script: curl -sL https://git.io/goreleaser | bash
      on:
        tags: true
        condition: "${TRAVIS_TAG} =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+$"
    - provider: npm
      email: presidium@spandigital.com
      api_key:
        secure: YnHUaE/DF4nIrcUz6prrIMM4tbZRD3l0Gai3Rt6kufALxqhhuWwm3Y2Ub3Wu9xKvzdO0rSdtLABAVSnCfWi6bupy+YkE0uhdwOqsrSt9X+BVov/3XCNy7vHK0sif1XdSgfcud2y4EXnVchu7VsKl+ZZaNqQ36HRkpe8szWF5UujWEEHxiLrp6/WpY5lTp2NXfhbTAzmi74K0Eqg4Q0JhX5NvHAQUQVIjJszaugC8ZCQ30ODftW7/QgNxgtvXh3DdOwYs15yCfLInAkYpA3VJK/08pnGzCgWChoJ9J0pzhvYeIIUEFZIbBcsCsaVsxgwdC53EkFo3A7xTQJm2TQBrgYVN0uHngW+pXjQ56Am85YLS7qwzSmPTrwdUQFEwwW4yyirwstSV0B/Iw7QtyzXBF6ozR0tvJtiNXFN7zmhA5yRxcduEcmggClqt3KnaPuqk3F9Ne71OxE/ToqZW1k9JBEXKkwjXT/kVxhrR6SBiTf01Ze3gdDjqHifA16NAd/0pP32xA2Db1TPiBqxnqLRKTMVXpvJ8Rgg4Sj/CGeEFqM0kuCFO7AbBSTmqAVWSuMlOdtfbOG2vACD6sBoO33sF+kpM8yoIH9IvcMQUfzndqKR6iUOtjIXrZB/KKPNsDvNoDJHO8/3mTdmTKRdq/nX4B4fibUr+cHeqvdbhx9J8PvI=
      on:
        tags: true
        repo: SPANDigital/presidium-oapi3
        condition: "${TRAVIS_TAG} =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+$"
    after_deploy:
    - "./build/ci/tags_cleanup.sh"
env:
  global:
  - secure: FrVqRlM/5+p8+hdkeXbcsVXGNcnlDAJSDGkAv2KKgU7sKkwpKKrk1ZkHB7tvRk1yf2pgX8B+y7MUh4sBau5qbJeuyGjyThTjqtfrYYiBMZU9WYhG/VqDKlwYiE2ywvGhcSiGwPjWF1CR/ldgsOJ6pkOIhgzcAt7cO8S/7TZmnUxh8u/tfL7UgVi3aJ/XAZyjpBFhnKFKrAUb8j1lNC6R8kb9DFCSZLil7sKrpKsR0sXtLDI5PCQoHqtYc3U2z0WTSNiiQ9P+R2qlh8zjBPUn8Uzh2zpiG5PVOzPxjoBvIp7OCoCVJsmPPNxWAcqLu9aWC3yqwGeUgf/23cVaGqiA4B1S9IMnysh0R587q+CIUurJXgn3+OHky20lcAYNtDL0Y+qbldcCzp9dJ73Tp25o485DCZ9LAW7uxQLmeNA75YZMTHmY5rcbxA85Is6LhBalFNLKnOatq/o+7f0fhEvpS8cbXf6yZ+vL4e1O4qeGF1KnOEALnIffENAq76mmMoVW3S4iwtRL2AE5yzd4xB81EtOZ7XeWAz06t93BLoIvnZpVt3QSruRKh9+hUCdkQ0gS2cYimWgv0p/zVcpCAiXu1dsEjYLEJtz7UnvnZOfTV9ERRKpbcaFlSEXgooXdG7/SHK4dPZU9UAx7TFBJW+M+VJWf2D9MdayH36r/WJrILo0=
