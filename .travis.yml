jobs:
  include:
  - stage: Tag code
    if: branch IN (develop, master) AND type = push AND NOT (commit_message =~ /^.*\[NPM
      version\].*$/)
    language: go
    go:
    - 1.17.x
    services:
    - docker
    git:
      depth: false
    script:
    - "./build/ci/tag_code.sh"
  - stage: Release
    if: tag IS present
    language: go
    go:
    - 1.17.x
    script:
    - curl -sfL https://git.io/goreleaser | sh -s -- check
    deploy:
    - provider: script
      skip_cleanup: true
      script: curl -sL https://git.io/goreleaser | bash
      on:
        tags: true
        condition: "${TRAVIS_TAG} =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+$"
    - provider: npm
      email: presidium@spandigital.com
      api_key:
        secure: YnHUaE/DF4nIrcUz6prrIMM4tbZRD3l0Gai3Rt6kufALxqhhuWwm3Y2Ub3Wu9xKvzdO0rSdtLABAVSnCfWi6bupy+YkE0uhdwOqsrSt9X+BVov/3XCNy7vHK0sif1XdSgfcud2y4EXnVchu7VsKl+ZZaNqQ36HRkpe8szWF5UujWEEHxiLrp6/WpY5lTp2NXfhbTAzmi74K0Eqg4Q0JhX5NvHAQUQVIjJszaugC8ZCQ30ODftW7/QgNxgtvXh3DdOwYs15yCfLInAkYpA3VJK/08pnGzCgWChoJ9J0pzhvYeIIUEFZIbBcsCsaVsxgwdC53EkFo3A7xTQJm2TQBrgYVN0uHngW+pXjQ56Am85YLS7qwzSmPTrwdUQFEwwW4yyirwstSV0B/Iw7QtyzXBF6ozR0tvJtiNXFN7zmhA5yRxcduEcmggClqt3KnaPuqk3F9Ne71OxE/ToqZW1k9JBEXKkwjXT/kVxhrR6SBiTf01Ze3gdDjqHifA16NAd/0pP32xA2Db1TPiBqxnqLRKTMVXpvJ8Rgg4Sj/CGeEFqM0kuCFO7AbBSTmqAVWSuMlOdtfbOG2vACD6sBoO33sF+kpM8yoIH9IvcMQUfzndqKR6iUOtjIXrZB/KKPNsDvNoDJHO8/3mTdmTKRdq/nX4B4fibUr+cHeqvdbhx9J8PvI=
      on:
        tags: true
        repo: SPANDigital/presidium-oapi3
        condition: "${TRAVIS_TAG} =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+$"
    after_deploy:
    - "./build/ci/tags_cleanup.sh"
env:
  global:
  - secure: bSseBxXEUINcP+qpHO4KIqvM3hsv8eC/KjYDsQeD0VyKWc5O1tLyVKFr7mwucwArdBCgE/eBWz2tljHXJ9t4A2Whr2cSd2SOp32YkQRadulHVPaq6y6jNTbL9P9B1Q8HeAdi0aUxGf051zFMntd4Cm+1McZCVAc1ojTK1gtT8VaatY9AINbkhBVbYigH91tKqCMXOFOeqoRSyAKGVAsMFhAqifsYpLOH9WdNapmDzyDtc9flq6siVlAaYr8+Sf7iFceAwcbSMOUjOvgeSpGT9SQEWj+LMiP6pkMT14qEFXPZcM+NDtz6xFyK6QXadlV8zx28+IJkNCZYo2b3RzBtDydCQd4AsBDFlSUZlpLlrC5iIbYirQPY4s2kYlT0NivigGuTIQwgB+jC2QB63RwOfQmbuio6pibc7hH9kPoB2ccILqwyeXYfZCMOqTglzA67yTADvBBxnXiRDBJdmvZ6knxt3jke7tVB/mRoh5WJ5f9RfewXMyiss6dPUU1LW1Mw5JrMiCX7fpI5e9Y3pOJkDifRtPJCdxJIGADYIW/Rkz9vHOxXY6S5esvykuA9/EQcRHYIm/vROfQI/5LKL7UDbm+lkIt3JPf0A5tiMcz+bchl5Fs6R2YQNLpPvJfgYd8xC8z896OibqPn1yX0vze+uElnd8ZC/SLB6lv6sL5kTi8=
